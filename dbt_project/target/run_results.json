{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.11", "generated_at": "2025-10-10T02:11:55.983885Z", "invocation_id": "f411adab-f924-4ee4-9cce-66f20d02679e", "invocation_started_at": "2025-10-10T02:11:47.322331Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:51.297623Z", "completed_at": "2025-10-10T02:11:51.298722Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:51.298722Z", "completed_at": "2025-10-10T02:11:52.315135Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.0185132026672363, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-da14-0002-68aa0077a9b2"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.age_coe_dbt.stg_results", "compiled": true, "compiled_code": "-- models/staging/stg_results.sql\n\nwith raw as (\n  select * from DJ_WORK_DB.PUBLIC.RAW_RESULTS\n),\n\ntyped as (\n  select\n    id,\n    custom_id,\n    create_user,\n    try_to_timestamp_ntz(to_varchar(result_time)) as result_time,\n    name,\n    method,\n    case method\n      when 'AE' then 'Estimation'\n      when 'AV' then 'Verification'\n      when 'AI' then 'Inference'\n      else method\n    end as method_norm,\n    try_to_number(to_varchar(age_gate)) as age_gate,\n    subject_id,\n    try_to_date(to_varchar(date_of_birth)) as date_of_birth,\n    try_to_number(to_varchar(age_in_months)) as age_in_months_num,\n    country_of_birth_subject,\n    country_of_birth_mother,\n    country_of_birth_father,\n    origin,\n\n    /* verification flag (raw) */\n    case\n      when upper(coalesce(to_varchar(verification_status), '')) in ('TRUE','T','1','Y','YES') then true\n      when upper(coalesce(to_varchar(verification_status), '')) in ('FALSE','F','0','N','NO') then false\n      else null\n    end as verification_status_bool_raw,\n\n    /* keep original text so we can parse seconds later */\n    to_varchar(verification_time) as verification_time,\n\n    /* subject age in years (raw):\n       1) use age_in_months when present,\n       2) else derive from date_of_birth + result_time\n    */\n    coalesce(\n      case when age_in_months_num is not null then age_in_months_num / 12.0 end,\n      case\n        when date_of_birth is not null and result_time is not null\n        then datediff(month, date_of_birth, result_time) / 12.0\n      end\n    ) as subject_age_years_raw\n\n  from raw\n),\n\ncalc as (\n  select\n    *,\n    case\n      when 'false' ilike 'true'\n      then not verification_status_bool_raw\n      else verification_status_bool_raw\n    end as verification_status_bool\n  from typed\n)\n\nselect\n  id,\n  custom_id,\n  create_user,\n  result_time,\n  name,\n  method,\n  method_norm,\n  age_gate,\n  subject_id,\n  date_of_birth,\n  age_in_months_num,\n  country_of_birth_subject,\n  country_of_birth_mother,\n  country_of_birth_father,\n  origin,\n\n  /* clamp to a sensible range */\n  case\n    when subject_age_years_raw between 0 and 110 then subject_age_years_raw\n    else null\n  end as subject_age_years,\n\n  verification_status_bool,\n\n  /* parse hh:mm:ss(.fff) \u2192 total seconds */\n  case\n    when verification_time is null then null\n    else\n      split_part(verification_time, ':', 1)::int * 3600 +\n      split_part(verification_time, ':', 2)::int * 60 +\n      split_part(verification_time, ':', 3)::float\n  end as verification_seconds\n\nfrom calc", "relation_name": "DJ_WORK_DB.PUBLIC.stg_results", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:52.388990Z", "completed_at": "2025-10-10T02:11:52.415226Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:52.417241Z", "completed_at": "2025-10-10T02:11:52.602170Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2492690086364746, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-dbf7-0002-68aa00777a46"}, "message": null, "failures": 0, "unique_id": "test.age_coe_dbt.not_null_stg_results_subject_id.acea2db565", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect subject_id\nfrom DJ_WORK_DB.PUBLIC.stg_results\nwhere subject_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:52.332993Z", "completed_at": "2025-10-10T02:11:52.352901Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:52.365842Z", "completed_at": "2025-10-10T02:11:53.204280Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.8712866306304932, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-dbf7-0002-68aa00777a4a"}, "message": null, "failures": 0, "unique_id": "test.age_coe_dbt.accepted_values_stg_results_method_norm__Estimation__Verification__Inference.6744438814", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        method_norm as value_field,\n        count(*) as n_records\n\n    from DJ_WORK_DB.PUBLIC.stg_results\n    group by method_norm\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'Estimation','Verification','Inference'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:52.388085Z", "completed_at": "2025-10-10T02:11:52.399426Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:52.399426Z", "completed_at": "2025-10-10T02:11:53.287543Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.9349658489227295, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-dbf7-0002-68aa00777a4e"}, "message": null, "failures": 0, "unique_id": "test.age_coe_dbt.dbt_utils_expression_is_true_stg_results_verification_seconds_is_null_or_verification_seconds_0.5d527890b4", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom DJ_WORK_DB.PUBLIC.stg_results\n\nwhere not(verification_seconds is null or verification_seconds >= 0)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:52.352901Z", "completed_at": "2025-10-10T02:11:52.399426Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:52.399426Z", "completed_at": "2025-10-10T02:11:53.316031Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.9652645587921143, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-dbf7-0002-68aa00777a52"}, "message": null, "failures": 0, "unique_id": "test.age_coe_dbt.dbt_utils_expression_is_true_stg_results_subject_age_years_is_null_or_subject_age_years_between_0_and_110_.f74b2f3e7b", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom DJ_WORK_DB.PUBLIC.stg_results\n\nwhere not(subject_age_years is null or (subject_age_years between 0 and 110))\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:53.350116Z", "completed_at": "2025-10-10T02:11:53.383405Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:53.383405Z", "completed_at": "2025-10-10T02:11:53.936036Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.6006574630737305, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-dade-0002-68aa00779ac6"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.age_coe_dbt.metrics_verification_time", "compiled": true, "compiled_code": "-- models/marts/metrics_verification_time.sql\nwith src as (\n  select * from DJ_WORK_DB.PUBLIC.stg_results\n  where verification_seconds is not null\n)\nselect\n  method_norm as method,\n  count(*) as samples,\n  avg(verification_seconds) as mean_seconds,\n  median(verification_seconds) as median_seconds\nfrom src\ngroup by 1", "relation_name": "DJ_WORK_DB.PUBLIC.metrics_verification_time", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:53.316031Z", "completed_at": "2025-10-10T02:11:53.427444Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:53.427444Z", "completed_at": "2025-10-10T02:11:53.983418Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.6673877239227295, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-da1a-0002-68aa0077b35a"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.age_coe_dbt.int_abs_error", "compiled": true, "compiled_code": "\n\n\n\n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n  \n\n\n\n\n\nwith\nbase as (\n  select * from DJ_WORK_DB.PUBLIC.stg_results\n),\n\nraw_pred as (\n  select\n    id,\n    \n      null::float as predicted_age_years\n    \n  from DJ_WORK_DB.PUBLIC.RAW_RESULTS\n),\n\njoined as (\n  select\n    b.*,\n    r.predicted_age_years\n  from base b\n  left join raw_pred r using (id)\n)\n\nselect\n  *,\n  case\n    when predicted_age_years is not null and subject_age_years is not null\n      then abs(predicted_age_years - subject_age_years)\n    else null\n  end as absolute_error\nfrom joined", "relation_name": "DJ_WORK_DB.PUBLIC.int_abs_error", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:53.348412Z", "completed_at": "2025-10-10T02:11:53.365098Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:53.366085Z", "completed_at": "2025-10-10T02:11:54.131076Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.7956969738006592, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-dbba-0002-68aa0077d616"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.age_coe_dbt.metrics_gates_by_method", "compiled": true, "compiled_code": "with src as (\n  select * from DJ_WORK_DB.PUBLIC.stg_results\n  where subject_age_years between 0 and 100 and verification_status_bool is not null\n),\ncalc as (\n  select method_norm,\n         iff(subject_age_years>=13,1,0) as truth_13,\n         iff(subject_age_years>=16,1,0) as truth_16,\n         iff(subject_age_years>=18,1,0) as truth_18,\n         iff(verification_status_bool,1,0) as pred\n  from src\n),\ng13 as (\n  select method_norm, '13' as gate,\n         count(*) samples,\n         sum(iff(pred=1 and truth_13=1,1,0)) tp,\n         sum(iff(pred=0 and truth_13=0,1,0)) tn,\n         sum(iff(pred=1 and truth_13=0,1,0)) fp,\n         sum(iff(pred=0 and truth_13=1,1,0)) fn\n  from calc group by 1\n),\ng16 as (\n  select method_norm, '16' gate, count(*) samples,\n         sum(iff(pred=1 and truth_16=1,1,0)) tp,\n         sum(iff(pred=0 and truth_16=0,1,0)) tn,\n         sum(iff(pred=1 and truth_16=0,1,0)) fp,\n         sum(iff(pred=0 and truth_16=1,1,0)) fn\n  from calc group by 1\n),\ng18 as (\n  select method_norm, '18' gate, count(*) samples,\n         sum(iff(pred=1 and truth_18=1,1,0)) tp,\n         sum(iff(pred=0 and truth_18=0,1,0)) tn,\n         sum(iff(pred=1 and truth_18=0,1,0)) fp,\n         sum(iff(pred=0 and truth_18=1,1,0)) fn\n  from calc group by 1\n),\nunioned as (\n  select * from g13 union all select * from g16 union all select * from g18\n)\nselect method_norm, gate, samples, tp, tn, fp, fn,\n       (tp+tn)/nullif(samples,0) accuracy,\n       fp/nullif(fp+tn,0) fpr,\n       fn/nullif(tp+fn,0) fnr,\n       tp/nullif(tp+fn,0) tpr,\n       tn/nullif(tn+fp,0) tnr\nfrom unioned", "relation_name": "DJ_WORK_DB.PUBLIC.metrics_gates_by_method", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:53.335379Z", "completed_at": "2025-10-10T02:11:53.350116Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:53.350116Z", "completed_at": "2025-10-10T02:11:54.263427Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.9280478954315186, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-da1a-0002-68aa0077b356"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.age_coe_dbt.metrics_gates", "compiled": true, "compiled_code": "-- models/marts/metrics_gates.sql\nwith src as (\n  select * from DJ_WORK_DB.PUBLIC.stg_results\n),\nlabels as (\n  select\n    *,\n    -- truth: subject age >= gate\n    (subject_age_years >= 13) as truth_13,\n    (subject_age_years >= 16) as truth_16,\n    (subject_age_years >= 18) as truth_18\n  from src\n  where subject_age_years between 0 and 100\n    and verification_status_bool is not null\n),\nper_gate as (\n  select '13' as gate,\n    count(*) as samples,\n    sum(iff(verification_status_bool and truth_13,1,0)) as tp,\n    sum(iff(not verification_status_bool and not truth_13,1,0)) as tn,\n    sum(iff(verification_status_bool and not truth_13,1,0)) as fp,\n    sum(iff(not verification_status_bool and truth_13,1,0)) as fn\n  from labels\n  union all\n  select '16',\n    count(*),\n    sum(iff(verification_status_bool and truth_16,1,0)),\n    sum(iff(not verification_status_bool and not truth_16,1,0)),\n    sum(iff(verification_status_bool and not truth_16,1,0)),\n    sum(iff(not verification_status_bool and truth_16,1,0))\n  from labels\n  union all\n  select '18',\n    count(*),\n    sum(iff(verification_status_bool and truth_18,1,0)),\n    sum(iff(not verification_status_bool and not truth_18,1,0)),\n    sum(iff(verification_status_bool and not truth_18,1,0)),\n    sum(iff(not verification_status_bool and truth_18,1,0))\n  from labels\n),\nmetrics as (\n  select\n    gate,\n    samples,\n    tp, tn, fp, fn,\n    (tp+tn)/nullif(samples,0) as accuracy,\n    fp/nullif(fp+tn,0) as fpr,\n    fn/nullif(tp+fn,0) as fnr,\n    tp/nullif(tp+fn,0) as tpr,\n    tn/nullif(tn+fp,0) as tnr\n  from per_gate\n)\nselect * from metrics", "relation_name": "DJ_WORK_DB.PUBLIC.metrics_gates", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:54.283365Z", "completed_at": "2025-10-10T02:11:54.283365Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:54.283365Z", "completed_at": "2025-10-10T02:11:54.480455Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.19708967208862305, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-dbba-0002-68aa0077d61a"}, "message": null, "failures": 0, "unique_id": "test.age_coe_dbt.dbt_utils_expression_is_true_metrics_gates_samples_coalesce_tp_0_coalesce_tn_0_coalesce_fp_0_coalesce_fn_0_.080b17c892", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom DJ_WORK_DB.PUBLIC.metrics_gates\n\nwhere not(samples = coalesce(tp,0)+coalesce(tn,0)+coalesce(fp,0)+coalesce(fn,0))\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:54.279626Z", "completed_at": "2025-10-10T02:11:54.283365Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:54.298808Z", "completed_at": "2025-10-10T02:11:54.480455Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.20241665840148926, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-da14-0002-68aa0077a9b6"}, "message": null, "failures": 0, "unique_id": "test.age_coe_dbt.dbt_utils_expression_is_true_metrics_gates_accuracy_between_0_and_1_and_fpr_between_0_and_1_and_fnr_between_0_and_1_and_tpr_between_0_and_1_and_tnr_between_0_and_1.be9de76804", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom DJ_WORK_DB.PUBLIC.metrics_gates\n\nwhere not(accuracy between 0 and 1 and fpr between 0 and 1 and fnr between 0 and 1 and tpr between 0 and 1 and tnr between 0 and 1)\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-10T02:11:53.983418Z", "completed_at": "2025-10-10T02:11:53.983418Z"}, {"name": "execute", "started_at": "2025-10-10T02:11:53.983418Z", "completed_at": "2025-10-10T02:11:55.386783Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.4033639430999756, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bf9b63-3204-db79-0002-68aa0077f41e"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.age_coe_dbt.metrics_estimation", "compiled": true, "compiled_code": "-- models/marts/metrics_estimation.sql\n\nwith src as (\n  select * from DJ_WORK_DB.PUBLIC.int_abs_error\n),\n\noverall as (\n  select\n    'overall' as slice_type,\n    null as gate,\n    count_if(absolute_error is not null) as samples,\n    avg(absolute_error) as mae_years,\n    stddev_samp(absolute_error) as sd_years\n  from src\n),\n\nper_gate as (\n  -- compute per-gate MAE using truth vs gate thresholds\n  select\n    'gate' as slice_type,\n    g as gate,\n    count_if(absolute_error is not null) as samples,\n    avg(absolute_error) as mae_years,\n    stddev_samp(absolute_error) as sd_years\n  from src,\n  lateral flatten(input => array_construct(13,16,18)) f,\n  lateral (select f.value::int as g)\n  group by 1,2\n)\n\nselect * from overall\nunion all\nselect * from per_gate", "relation_name": "DJ_WORK_DB.PUBLIC.metrics_estimation", "batch_results": null}], "elapsed_time": 6.49349308013916, "args": {"log_file_max_bytes": 10485760, "validate_macro_args": false, "state_modified_compare_more_unrendered_values": false, "log_path": "C:\\Users\\DhanrajJayendra\\Downloads\\age_coe_pipeline\\age_coe_pipeline\\dbt_project\\logs", "include_saved_query": false, "log_level_file": "debug", "require_generic_test_arguments_property": true, "require_all_warnings_handled_by_warn_error": false, "log_level": "info", "indirect_selection": "eager", "export_saved_queries": false, "printer_width": 80, "show_resource_report": false, "version_check": true, "require_batched_execution_for_custom_microbatch_strategy": false, "macro_debugging": false, "favor_state": false, "write_json": true, "require_nested_cumulative_type_params": false, "static_parser": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "print": true, "source_freshness_run_project_hooks": true, "show": false, "invocation_command": "dbt build --profiles-dir .", "select": [], "which": "build", "populate_cache": true, "use_fast_test_edges": false, "exclude": [], "require_explicit_package_overrides_for_builtin_materializations": true, "require_yaml_configuration_for_mf_time_spines": false, "project_dir": "C:\\Users\\DhanrajJayendra\\Downloads\\age_coe_pipeline\\age_coe_pipeline\\dbt_project", "log_format_file": "debug", "show_all_deprecations": false, "log_format": "default", "require_resource_names_without_spaces": true, "partial_parse_file_diff": true, "cache_selected_only": false, "skip_nodes_if_on_run_start_fails": false, "state_modified_compare_vars": false, "use_colors": true, "exclude_resource_types": [], "empty": false, "introspect": true, "strict_mode": false, "vars": {}, "partial_parse": true, "defer": false, "resource_types": [], "profiles_dir": ".", "send_anonymous_usage_stats": true, "quiet": false, "upload_to_artifacts_ingest_api": false, "use_colors_file": true}}